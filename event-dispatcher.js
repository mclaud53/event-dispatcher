"use strict";var Event=function(){function a(a,b,c,d){void 0===d&&(d={}),this._isDefaultPrevented=!1,this._type=a,this._target=b,this._cancellable=c,this._options=d}return Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cancellable",{get:function(){return this._cancellable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isDefaultPrevented",{get:function(){return this._isDefaultPrevented},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),a.prototype.preventDefault=function(){this.cancellable&&(this._isDefaultPrevented=!0)},a}();module.exports=Event;var EventDispatcher=function(){function a(){this._listeners=[],this._listenersSorted=!0,this._dispatchers=[],this._suspendCount=0,this._suspendQueue=!1,this._queue=[]}return Object.defineProperty(a.prototype,"hasListeners",{get:function(){return this._listeners.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"suspended",{get:function(){return this._suspendCount>0},enumerable:!0,configurable:!0}),a.prototype.add=function(a,b,c,d){void 0===c&&(c=null),void 0===d&&(d=null);var e,f,g=null;for(e=0;e<this._listeners.length;e++)if(this._listeners[e].listener===a&&this._listeners[e].scope===b){g=this._listeners[e];break}null===g?(g=new ListenerHelper(a,b,c,d),this._listeners.length>0&&this._listeners[0].priority<g.priority&&(this._listenersSorted=!1),this._listeners.unshift(g)):(g.allowEventType(c),f=g.priority,g.options=d,f!==g.priority&&(this._listenersSorted=!1))},a.prototype.addAll=function(a){var b;for(b=a.length-1;b>=0;b--)this.add(a[b].listener,a[b].scope,a[b].eventType,a[b].options)},a.prototype.dispatch=function(a){var b,c=this;if(this.suspended&&!a.cancellable)return void(this._suspendQueue&&this._queue.push(a));for(this._listenersSorted||this._sortListeners(),b=this._listeners.length-1;b>=0;b--)this._listeners[b].dispatch(a),this._listeners[b].single&&(this._listeners[b].buffer?this._listeners[b].onDispatch=function(a,b){var d=c._listeners.indexOf(a);a.onDispatch=null,d>-1&&c._listeners.splice(d,1)}:this._listeners.splice(b,1))},a.prototype.has=function(a,b){var c;for(c=0;c<this._listeners.length;c++)if(this._listeners[c].listener===a&&this._listeners[c].scope===b)return!0;return!1},a.prototype.remove=function(a,b,c){void 0===c&&(c=null);var d,e=null;for(d=this._listeners.length-1;d>=0;d++)if(e=this._listeners[d],e.listener===a&&e.scope===b){null===c?this._listeners.splice(d,1):(e.denyEventType(c),e.hasEventTypes||this._listeners.splice(d,1));break}},a.prototype.removeAll=function(a){var b;for(b=0;b<a.length;b++)this.remove(a[b].listener,a[b].scope,a[b].eventType)},a.prototype.suspend=function(a){this._suspendCount++,a&&(this._suspendQueue=!0)},a.prototype.resume=function(){var a;for(this._suspendCount>0&&this._suspendCount--;!this.suspended&&this._queue.length>0;)a=this._queue.shift(),this.dispatch(a);this.suspended||(this._suspendQueue=!1)},a.prototype.relay=function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=null),this.relayed(a)||(a.add(this.onEvent,this,b,c),this._dispatchers.push(a))},a.prototype.relayAll=function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=null);var d;for(d=0;d<a.length;d++)this.relay(a[d],b,c)},a.prototype.relayed=function(a){return this._dispatchers.indexOf(a)>-1},a.prototype.unrelay=function(a,b){void 0===b&&(b=null);var c=this._dispatchers.indexOf(a);c>-1&&(a.remove(this.onEvent,this,b),a.has(this.onEvent,this)||this._dispatchers.splice(c,1))},a.prototype.unrelayAll=function(a,b){void 0===b&&(b=null);var c;for(c=0;c<a.length;c++)this.unrelay(a[c],b)},a.prototype.purge=function(){this.purgeListeners(),this.purgeDispatchers(),this.purgeQueue()},a.prototype.purgeListeners=function(){this._listeners.length=0},a.prototype.purgeDispatchers=function(){var a;for(a=0;a<this._dispatchers.length;a++)this._dispatchers[a].remove(this.onEvent,this);this._dispatchers.length=0},a.prototype.purgeQueue=function(){this._queue.length=0},a.prototype.willDispatch=function(a){var b;if(!this.hasListeners)return!1;for(b=0;b<this._listeners.length;b++)if(this._listeners[b].willDispatch(a))return!0;return!1},a.prototype.onEvent=function(a){this.dispatch(a)},a.prototype._sortListeners=function(){this._listeners.sort(function(a,b){return a.priority-b.priority}),this._listenersSorted=!0},a}(),ListenerHelper=function(){function a(a,b,c,d){this._listOfAllowTypes=null,this._listOfDenyTypes=null,this._timeout=null,this.onDispatch=null,this._listener=a,this._scope=b,c instanceof Array?this._listOfAllowTypes=c:null!==c&&(this._listOfAllowTypes=[c]),this.options=d,this.buffer&&(this._timeout={})}return Object.defineProperty(a.prototype,"hasEventTypes",{get:function(){return null===this._listOfAllowTypes?!0:this._listOfAllowTypes.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"listener",{get:function(){return this._listener},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"scope",{get:function(){return this._scope},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"options",{get:function(){return this._options},set:function(a){null!==a&&(this._options=a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"single",{get:function(){return this._options?!!this._options.single:!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buffer",{get:function(){return this._options&&this._options.hasOwnProperty("buffer")&&this._options.buffer>0?+this._options.buffer:0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"delay",{get:function(){return this._options&&this._options.hasOwnProperty("delay")&&this._options.delay>0?+this._options.delay:0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"defer",{get:function(){return this._options&&this._options.hasOwnProperty("defer")?!!this._options.defer:!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"priority",{get:function(){return this._options&&this._options.hasOwnProperty("priority")?+this._options.priority:0},enumerable:!0,configurable:!0}),a.prototype.allowEventType=function(a){var b,c;if(null===a)return this._listOfAllowTypes=null,void(this._listOfDenyTypes instanceof Array&&(this._listOfDenyTypes.length=0));if(null===this._listOfAllowTypes){if(null===this._listOfDenyTypes||0===this._listOfDenyTypes.length)return;if(a instanceof Array)for(b=0;b<a.length;b++)c=this._listOfDenyTypes.indexOf(a[b]),c>-1&&this._listOfDenyTypes.splice(c,1);else c=this._listOfDenyTypes.indexOf(a),c>-1&&this._listOfDenyTypes.splice(c,1)}else if(a instanceof Array)for(b=0;b<a.length;b++)c=this._listOfAllowTypes.indexOf(a[b]),-1===c&&this._listOfAllowTypes.push(a[b]);else c=this._listOfAllowTypes.indexOf(a),-1===c&&this._listOfAllowTypes.push(a)},a.prototype.denyEventType=function(a){var b,c;if(null===this._listOfAllowTypes)if(null===this._listOfDenyTypes&&(this._listOfDenyTypes=[]),a instanceof Array)for(b=0;b<a.length;b++)c=this._listOfDenyTypes.indexOf(a[b]),-1===c&&this._listOfDenyTypes.push(a[b]);else c=this._listOfDenyTypes.indexOf(a),-1===c&&this._listOfDenyTypes.push(a);else if(a instanceof Array)for(b=0;b<a.length;b++)c=this._listOfAllowTypes.indexOf(a[b]),c>-1&&this._listOfAllowTypes.splice(c,1);else c=this._listOfAllowTypes.indexOf(a),c>-1&&this._listOfAllowTypes.splice(c,1)},a.prototype.dispatch=function(a){if(this.willDispatch(a.type))switch(!0){case!!this.buffer:this._dispatchBuffered(a);break;case!!this.delay:this._dispatchDelayed(a);break;case this.defer:this._dispatchDeferred(a);break;default:this._dispatch(a)}},a.prototype.willDispatch=function(a){return null===this._listOfAllowTypes?null===this._listOfDenyTypes||0===this._listOfDenyTypes.length?!0:-1===this._listOfDenyTypes.indexOf(a):this._listOfAllowTypes.indexOf(a)>-1},a.prototype._dispatchBuffered=function(a){var b=this;this._timeout.hasOwnProperty(a.type)&&clearTimeout(this._timeout[a.type]),this._timeout[a.type]=setTimeout(function(){delete b._timeout[a.type],b._dispatch(a)},this.buffer)},a.prototype._dispatchDelayed=function(a){var b=this;setTimeout(function(){b._dispatch(a)},this.delay)},a.prototype._dispatchDeferred=function(a){var b=this;setTimeout(function(){b._dispatch(a)},0)},a.prototype._dispatch=function(a){this._listener.call(this._scope,a),this.onDispatch&&this.onDispatch(this,a)},a}();module.exports=EventDispatcher;